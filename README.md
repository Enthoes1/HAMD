# 精神科量表评估系统

这是一个基于大语言模型的精神科量表评估系统，用于自动化进行精神科量表的评估过程。

## 项目结构

```
HAMD/
├── src/
│   ├── app.py                 # Flask应用主入口
│   ├── core/
│   │   ├── __init__.py
│   │   └── assessment_framework.py  # 评估框架核心逻辑
│   ├── llm/
│   │   ├── __init__.py
│   │   └── llm_handler.py     # 大语言模型处理器
│   ├── utils/
│   │   ├── __init__.py
│   │   └── prompt_parser.py   # 提示词解析器
│   ├── templates/
│   │   └── index.html         # 前端页面
│   └── speech/
│       ├── __init__.py
│       └── speech_handler.py   # 语音处理模块（待实现）
└── 提示词.txt                  # 量表评估提示词
```

## 核心模块说明

### 1. 提示词解析器 (PromptParser)
- 负责解析提示词文件
- 按照 #label# 标记分割不同的评估条目
- 保持提示词的原始结构，不做额外处理

### 2. 大语言模型处理器 (LLMHandler)
- 负责与大语言模型的交互
- 发送评估提示词和用户回答
- 识别模型响应类型（普通对话/评分输出）
- 解析评分JSON数据

### 3. 评估框架 (AssessmentFramework)
- 管理整个评估流程
- 存储评估条目和对话历史
- 处理用户响应
- 控制条目切换
- 维护评分数据

### 4. Web应用 (app.py)
- 提供Web界面
- 处理WebSocket连接
- 管理实时消息通信
- 展示评估状态和进度

## 工作流程

1. **初始化**
   - 加载提示词文件
   - 初始化评估条目
   - 建立WebSocket连接

2. **评估流程**
   - 显示当前评估条目的问题
   - 接收用户回答
   - 调用大语言模型进行评估
   - 如果得到评分结果：
     * 存储评分
     * 切换到下一个条目
   - 如果是普通对话：
     * 继续与用户交互
     * 存储对话历史

3. **数据存储**
   - 评分数据：使用字典存储每个条目的评分
   - 对话历史：记录每个条目的完整对话过程

## 使用说明

1. 安装依赖：
```bash
pip install flask flask-socketio eventlet openai
```

2. 设置环境变量：
```bash
export DASHSCOPE_API_KEY=your_api_key
```

3. 运行应用：
```bash
python src/app.py
```

4. 访问界面：
   打开浏览器访问 http://localhost:5000

## 注意事项

1. 提示词文件格式要求：
   - 使用 #label# 标记不同条目
   - 每个条目包含完整的评估说明和评分标准
   - 评分输出需要使用指定的JSON格式

2. 评分规则：
   - 系统会自动识别JSON格式的评分输出
   - 评分数据会被自动存储并触发下一个条目
   - 非评分的对话会继续进行交互

3. 对话历史：
   - 系统会保存每个条目的完整对话记录
   - 包括用户输入和系统响应 