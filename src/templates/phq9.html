<!DOCTYPE html>
<html>
<head>
    <title>PHQ-9 自评量表</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            background-color: #f5f5f5;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #007bff;
        }

        .instruction {
            margin-bottom: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }

        .question {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .question p {
            margin-bottom: 10px;
            font-weight: 500;
        }

        .options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .option {
            flex: 1;
            min-width: 200px;
        }

        .option label {
            display: flex;
            align-items: center;
            padding: 8px;
            cursor: pointer;
            border: 1px solid #ddd;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .option label:hover {
            background-color: #f8f9fa;
        }

        .option input[type="radio"] {
            margin-right: 8px;
        }

        .option input[type="radio"]:checked + label {
            background-color: #007bff;
            color: white;
            border-color: #007bff;
        }

        button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 20px;
        }

        button:hover {
            background-color: #0056b3;
        }

        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
            display: none;
        }

        @media (max-width: 768px) {
            .option {
                min-width: 100%;
            }
        }

        .header {
            background-color: #007bff;
            color: white;
            padding: 1rem;
            text-align: center;
            margin-bottom: 20px;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header h1 {
            margin: 0;
            flex-grow: 1;
        }

        .header-button {
            background-color: white;
            color: #007bff;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            text-decoration: none;
            margin-left: 1rem;
        }

        .header-button:hover {
            background-color: #f8f9fa;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>PHQ-9 抑郁症筛查量表</h1>
            <a href="/" class="header-button">返回HAMD评估</a>
        </div>
        
        <div class="instruction">
            <p>在过去的两周里，您生活中以下症状出现的频率如何？</p>
            <p>请为每个问题选择一个最符合的选项。</p>
        </div>

        <form id="phq9-form">
            <div class="question">
                <p>1. 做事时提不起劲或没有兴趣</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q1" value="0" id="q1-0" required>
                        <label for="q1-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" value="1" id="q1-1">
                        <label for="q1-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" value="2" id="q1-2">
                        <label for="q1-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q1" value="3" id="q1-3">
                        <label for="q1-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>2. 感到心情低落、沮丧或绝望</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q2" value="0" id="q2-0" required>
                        <label for="q2-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" value="1" id="q2-1">
                        <label for="q2-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" value="2" id="q2-2">
                        <label for="q2-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q2" value="3" id="q2-3">
                        <label for="q2-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>3. 入睡困难、睡不安稳或睡眠过多</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q3" value="0" id="q3-0" required>
                        <label for="q3-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" value="1" id="q3-1">
                        <label for="q3-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" value="2" id="q3-2">
                        <label for="q3-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q3" value="3" id="q3-3">
                        <label for="q3-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>4. 感觉疲倦或没有活力</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q4" value="0" id="q4-0" required>
                        <label for="q4-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" value="1" id="q4-1">
                        <label for="q4-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" value="2" id="q4-2">
                        <label for="q4-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q4" value="3" id="q4-3">
                        <label for="q4-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>5. 食欲不振或过量饮食</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q5" value="0" id="q5-0" required>
                        <label for="q5-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" value="1" id="q5-1">
                        <label for="q5-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" value="2" id="q5-2">
                        <label for="q5-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q5" value="3" id="q5-3">
                        <label for="q5-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>6. 觉得自己很糟或觉得自己很失败，或让自己或家人失望</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q6" value="0" id="q6-0" required>
                        <label for="q6-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" value="1" id="q6-1">
                        <label for="q6-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" value="2" id="q6-2">
                        <label for="q6-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q6" value="3" id="q6-3">
                        <label for="q6-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>7. 对事物专注有困难，例如阅读报纸或看电视时</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q7" value="0" id="q7-0" required>
                        <label for="q7-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" value="1" id="q7-1">
                        <label for="q7-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" value="2" id="q7-2">
                        <label for="q7-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q7" value="3" id="q7-3">
                        <label for="q7-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>8. 行动或说话速度变得缓慢（或相反，变得比平常更烦躁或坐立不安）</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q8" value="0" id="q8-0" required>
                        <label for="q8-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" value="1" id="q8-1">
                        <label for="q8-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" value="2" id="q8-2">
                        <label for="q8-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q8" value="3" id="q8-3">
                        <label for="q8-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <div class="question">
                <p>9. 有不如死掉或用某种方式伤害自己的念头</p>
                <div class="options">
                    <div class="option">
                        <input type="radio" name="q9" value="0" id="q9-0" required>
                        <label for="q9-0">完全没有</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" value="1" id="q9-1">
                        <label for="q9-1">有几天</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" value="2" id="q9-2">
                        <label for="q9-2">一半以上时间</label>
                    </div>
                    <div class="option">
                        <input type="radio" name="q9" value="3" id="q9-3">
                        <label for="q9-3">几乎每天</label>
                    </div>
                </div>
            </div>

            <button type="submit">提交评估</button>
        </form>

        <div class="result" id="result">
            <h2>评估结果</h2>
            <p>总分：<span id="total-score">0</span></p>
            <p>评估结果：<span id="interpretation"></span></p>
        </div>
    </div>

    <script>
        document.getElementById('phq9-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            // 计算总分
            let totalScore = 0;
            for (let i = 1; i <= 9; i++) {
                const value = parseInt(document.querySelector(`input[name="q${i}"]:checked`).value);
                totalScore += value;
            }
            
            // 显示结果
            document.getElementById('total-score').textContent = totalScore;
            
            // 解释结果
            let interpretation = '';
            if (totalScore >= 0 && totalScore <= 4) {
                interpretation = '无抑郁症状';
            } else if (totalScore >= 5 && totalScore <= 9) {
                interpretation = '轻度抑郁症状';
            } else if (totalScore >= 10 && totalScore <= 14) {
                interpretation = '中度抑郁症状';
            } else if (totalScore >= 15 && totalScore <= 19) {
                interpretation = '中重度抑郁症状';
            } else {
                interpretation = '重度抑郁症状';
            }
            
            document.getElementById('interpretation').textContent = interpretation;
            document.getElementById('result').style.display = 'block';

            // 发送结果到服务器
            const patientId = localStorage.getItem('patientId');
            if (patientId) {
                fetch('/save_phq9', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        patient_id: patientId,
                        total_score: totalScore,
                        interpretation: interpretation,
                        answers: Array.from({length: 9}, (_, i) => ({
                            question: i + 1,
                            score: parseInt(document.querySelector(`input[name="q${i+1}"]:checked`).value)
                        }))
                    })
                });
            }
        });
    </script>
</body>
</html>